# ğŸ§® TypeScript Calculator Compiler

ä¸€ä¸ªåŸºäº EBNF è¯­æ³•çš„ TypeScript è®¡ç®—å™¨ç¼–è¯‘å™¨ï¼Œæ”¯æŒè¡¨è¾¾å¼è§£æã€AST æ„å»ºå’Œæ±‡ç¼–ä»£ç ç”Ÿæˆã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘å™¨å‰ç«¯ï¼ŒåŒ…æ‹¬ï¼š
- **è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰**ï¼šå°†è¾“å…¥å­—ç¬¦ä¸²è½¬æ¢ä¸º Token åºåˆ—
- **è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰**ï¼šåŸºäº EBNF è¯­æ³•çš„é€’å½’ä¸‹é™è§£æå™¨
- **AST æ„å»º**ï¼šæ„å»ºæŠ½è±¡è¯­æ³•æ ‘
- **ä»£ç ç”Ÿæˆ**ï¼šç”Ÿæˆæ±‡ç¼–ä»£ç 
- **è¡¨è¾¾å¼æ±‚å€¼**ï¼šç›´æ¥è®¡ç®—è¡¨è¾¾å¼ç»“æœ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Bun è¿è¡Œæ—¶

### å®‰è£…ä¾èµ–
```bash
bun install
```

### è¿è¡Œç¨‹åº
```bash
# BNFæ–¹æ³•ï¼ˆé€’å½’ä¸‹é™ï¼‰
bun run bnf:integrated          # BNFé›†æˆç‰ˆæœ¬ï¼ˆè§£æ+æ±‚å€¼ï¼‰
bun run bnf:separated           # BNFåˆ†ç¦»ç‰ˆæœ¬ï¼ˆè§£æ+AST+ä»£ç ç”Ÿæˆï¼‰

# ä¼˜å…ˆçº§çˆ¬å‡æ–¹æ³•
bun run precedence:integrated    # ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬ï¼ˆè§£æ+æ±‚å€¼ï¼‰
bun run precedence:separated     # ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬ï¼ˆè§£æ+AST+ä»£ç ç”Ÿæˆï¼‰

# è¿è¡Œæµ‹è¯•
bun run test:all                # è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆåŒ…å«æ‰€æœ‰ç‰ˆæœ¬ï¼‰
bun run test:basic              # åŸºæœ¬è¡¨è¾¾å¼æµ‹è¯•
bun run test:edge               # è¾¹ç•Œæƒ…å†µæµ‹è¯•
bun run test:precedence         # è¿ç®—ç¬¦ä¼˜å…ˆçº§æµ‹è¯•
bun run test:performance        # æ€§èƒ½æµ‹è¯•

# ç‰¹å®šç‰ˆæœ¬æµ‹è¯•
bun run test:bnf-integrated     # æµ‹è¯•BNFé›†æˆç‰ˆæœ¬
bun run test:bnf-separated      # æµ‹è¯•BNFåˆ†ç¦»ç‰ˆæœ¬
bun run test:precedence-integrated   # æµ‹è¯•ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬
bun run test:precedence-separated    # æµ‹è¯•ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
bnf/
â”œâ”€â”€ bnf/                                  # BNFæ–¹æ³•ï¼ˆé€’å½’ä¸‹é™ï¼‰æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ index.ts                          # BNFé›†æˆç‰ˆæœ¬ï¼ˆè§£æ+æ±‚å€¼ï¼‰
â”‚   â””â”€â”€ separated.ts                      # BNFåˆ†ç¦»ç‰ˆæœ¬ï¼ˆè§£æ+AST+ä»£ç ç”Ÿæˆï¼‰
â”œâ”€â”€ precedence-climbing/                  # ä¼˜å…ˆçº§çˆ¬å‡æ–¹æ³•æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ index.ts                          # ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬ï¼ˆè§£æ+æ±‚å€¼ï¼‰
â”‚   â””â”€â”€ separated.ts                      # ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬ï¼ˆè§£æ+AST+ä»£ç ç”Ÿæˆï¼‰
â”œâ”€â”€ test/                                 # æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ basic-expressions.txt             # åŸºæœ¬è¡¨è¾¾å¼æµ‹è¯•
â”‚   â”œâ”€â”€ edge-cases.txt                    # è¾¹ç•Œæƒ…å†µæµ‹è¯•
â”‚   â”œâ”€â”€ operator-precedence.txt           # è¿ç®—ç¬¦ä¼˜å…ˆçº§æµ‹è¯•
â”‚   â”œâ”€â”€ performance.txt                   # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ error-cases.txt                   # é”™è¯¯æƒ…å†µæµ‹è¯•
â”‚   â””â”€â”€ README.md                         # æµ‹è¯•è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ docs/                                 # æ–‡æ¡£æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ expression-analysis.md            # è¡¨è¾¾å¼æ‰§è¡Œæµç¨‹åˆ†æ
â”‚   â”œâ”€â”€ operator-associativity.md         # è¿ç®—ç¬¦ç»“åˆæ€§åˆ†æ
â”‚   â””â”€â”€ precedence-climbing-analysis.md # ä¼˜å…ˆçº§çˆ¬å‡ç®—æ³•åˆ†æ
â”œâ”€â”€ runner.ts                             # æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ package.json                          # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json                         # TypeScript é…ç½®
â””â”€â”€ README.md                             # é¡¹ç›®è¯´æ˜
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. æ”¯æŒçš„è¿ç®—ç¬¦
- **ç®—æœ¯è¿ç®—**ï¼š`+`, `-`, `*`, `/`
- **æŒ‡æ•°è¿ç®—**ï¼š`**`ï¼ˆå³ç»“åˆï¼‰
- **æ‹¬å·**ï¼š`()`
- **è´Ÿæ•°**ï¼š`-123`

### 2. è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
1. **æ‹¬å·å’Œè´Ÿæ•°**ï¼š`()`, `-123`
2. **æŒ‡æ•°è¿ç®—**ï¼š`**`ï¼ˆå³ç»“åˆï¼‰
3. **ä¹˜é™¤è¿ç®—**ï¼š`*`, `/`ï¼ˆå·¦ç»“åˆï¼‰
4. **åŠ å‡è¿ç®—**ï¼š`+`, `-`ï¼ˆå·¦ç»“åˆï¼‰

### 3. è¯­æ³•è§„åˆ™ï¼ˆEBNFï¼‰
```
<Expr> ::= <AddSubExpr>
<AddSubExpr> ::= <MulDivExpr> {('+'|'-') <MulDivExpr>}
<MulDivExpr> ::= <PowerExpr> {('*'|'/') <PowerExpr>}
<PowerExpr> ::= <PrimaryExpr> {'**' <PrimaryExpr>}
<PrimaryExpr> ::= NUM | '-'NUM | '('<Expr>')'
```

## ğŸ”§ å››ç§å®ç°æ–¹å¼å¯¹æ¯”

### 1. BNFé›†æˆç‰ˆæœ¬ï¼ˆ`bnf/index.ts`ï¼‰
- **ç‰¹ç‚¹**ï¼šé€’å½’ä¸‹é™è§£æ + ç›´æ¥æ±‚å€¼
- **ä¼˜ç‚¹**ï¼šä»£ç ç®€æ´ï¼Œé€‚åˆè§£é‡Šå™¨
- **ç¼ºç‚¹**ï¼šæ— æ³•ç”Ÿæˆä¸­é—´ä»£ç 

```typescript
// ç¤ºä¾‹ï¼š1+2*3
function evalExpr(): number {
    return evalAddSubExpr();
}
```

### 2. BNFåˆ†ç¦»ç‰ˆæœ¬ï¼ˆ`bnf/separated.ts`ï¼‰
- **ç‰¹ç‚¹**ï¼šé€’å½’ä¸‹é™è§£æ + ASTæ„å»º + æ±‡ç¼–ä»£ç ç”Ÿæˆ
- **ä¼˜ç‚¹**ï¼šå¯æ‰©å±•ï¼Œæ”¯æŒä»£ç ç”Ÿæˆï¼Œç»“æ„æ¸…æ™°
- **ç¼ºç‚¹**ï¼šä»£ç å¤æ‚åº¦è¾ƒé«˜

```typescript
// ç¤ºä¾‹ï¼šç”Ÿæˆ AST å’Œæ±‡ç¼–ä»£ç 
const ast = parseExpr();
const assembly = generator.generate(ast);
```

### 3. ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬ï¼ˆ`precedence-climbing/index.ts`ï¼‰
- **ç‰¹ç‚¹**ï¼šwhileå¾ªç¯æ–¹å¼ï¼Œç›´æ¥æ±‚å€¼
- **ä¼˜ç‚¹**ï¼šé¿å…é€’å½’æ·±åº¦é™åˆ¶ï¼Œç®—æ³•ç´§å‡‘
- **ç¼ºç‚¹**ï¼šæ— æ³•ç”Ÿæˆä¸­é—´ä»£ç 

```typescript
// ç¤ºä¾‹ï¼šwhileå¾ªç¯å¤„ç†æ‰€æœ‰ä¼˜å…ˆçº§
function parseExpression(minPrecedence: Precedence): number {
    let left = parsePrimary();
    while (true) {
        const precedence = getPrecedence(token);
        if (precedence < minPrecedence) break;
        // å¤„ç†æ“ä½œç¬¦...
    }
}
```

### 4. ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬ï¼ˆ`precedence-climbing/separated.ts`ï¼‰
- **ç‰¹ç‚¹**ï¼šwhileå¾ªç¯æ–¹å¼ + ASTæ„å»º + æ±‡ç¼–ä»£ç ç”Ÿæˆ
- **ä¼˜ç‚¹**ï¼šç»“åˆäº†ä¼˜å…ˆçº§çˆ¬å‡çš„æ•ˆç‡å’Œåˆ†ç¦»å¼çš„æ‰©å±•æ€§
- **ç¼ºç‚¹**ï¼šç®—æ³•ç†è§£éš¾åº¦è¾ƒé«˜

| å®ç°æ–¹å¼ | è§£æç®—æ³• | è¾“å‡ºç±»å‹ | ä»£ç ç”Ÿæˆ | é€’å½’æ·±åº¦ |
|----------|----------|----------|----------|----------|
| BNFé›†æˆç‰ˆæœ¬ | é€’å½’ä¸‹é™ | ç›´æ¥æ±‚å€¼ | âŒ | æœ‰é™åˆ¶ |
| BNFåˆ†ç¦»ç‰ˆæœ¬ | é€’å½’ä¸‹é™ | AST | âœ… | æœ‰é™åˆ¶ |
| ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬ | whileå¾ªç¯ | ç›´æ¥æ±‚å€¼ | âŒ | æ— é™åˆ¶ |
| ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬ | whileå¾ªç¯ | AST | âœ… | æ— é™åˆ¶ |

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬è¿ç®—
```bash
$ echo "1+2*3" | bun run bnf:integrated
7

$ echo "2**3**2" | bun run precedence:integrated
512

$ echo "(1+2)*3" | bun run bnf:separated
9
```

### BNFåˆ†ç¦»ç‰ˆæœ¬ï¼ˆé€’å½’ä¸‹é™ï¼‰
```bash
$ echo "1+2*3" | bun run bnf:separated

=== ASTç»“æ„ ===
{
  "type": "BinaryOp",
  "operator": "+",
  "left": {"type": "Number", "value": 1},
  "right": {
    "type": "BinaryOp",
    "operator": "*",
    "left": {"type": "Number", "value": 2},
    "right": {"type": "Number", "value": 3}
  }
}

=== è®¡ç®—ç»“æœ ===
7

=== ç”Ÿæˆçš„æ±‡ç¼–ä»£ç  ===
mov eax, 1
mov t0, eax
mov eax, 2
mov t1, eax
mov eax, 3
mov ebx, t1
imul eax, ebx
mov ebx, t0
add eax, ebx
ret
```

### ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬ï¼ˆwhileå¾ªç¯æ–¹å¼ï¼‰
```bash
$ echo "1+2*3" | bun run precedence:separated

=== ASTç»“æ„ ===
{
  "type": "BinaryOp",
  "operator": "+",
  "left": {"type": "Number", "value": 1},
  "right": {
    "type": "BinaryOp",
    "operator": "*",
    "left": {"type": "Number", "value": 2},
    "right": {"type": "Number", "value": 3}
  }
}

=== è®¡ç®—ç»“æœ ===
7

=== ç”Ÿæˆçš„æ±‡ç¼–ä»£ç  ===
mov eax, 1
mov t0, eax
mov eax, 2
mov t1, eax
mov eax, 3
mov ebx, t1
imul eax, ebx
mov ebx, t0
add eax, ebx
ret
```

**æ³¨æ„**ï¼šä¸¤ç§è§£æå™¨ç”Ÿæˆçš„ASTå’Œæ±‡ç¼–ä»£ç å®Œå…¨ç›¸åŒï¼Œè¯æ˜äº†ä¸åŒè§£æç®—æ³•å¯ä»¥äº§ç”Ÿç›¸åŒçš„ç»“æœï¼

## ğŸ§ª æµ‹è¯•æ¡†æ¶

### è‡ªåŠ¨åŒ–æµ‹è¯•
é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æµ‹è¯•å’Œç»“æœéªŒè¯ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰- åŒ…å«æ‰€æœ‰å››ä¸ªç‰ˆæœ¬
bun run test:all

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
bun run test:basic              # åŸºæœ¬è¡¨è¾¾å¼ï¼ˆ20ä¸ªæµ‹è¯•ï¼‰
bun run test:edge               # è¾¹ç•Œæƒ…å†µï¼ˆ22ä¸ªæµ‹è¯•ï¼‰
bun run test:precedence         # è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆ17ä¸ªæµ‹è¯•ï¼‰
bun run test:performance        # æ€§èƒ½æµ‹è¯•ï¼ˆ16ä¸ªæµ‹è¯•ï¼‰

# è¿è¡Œç‰¹å®šç‰ˆæœ¬æµ‹è¯•
bun run test:bnf-integrated     # BNFé›†æˆç‰ˆæœ¬æµ‹è¯•
bun run test:bnf-separated      # BNFåˆ†ç¦»ç‰ˆæœ¬æµ‹è¯•
bun run test:precedence-integrated   # ä¼˜å…ˆçº§çˆ¬å‡é›†æˆç‰ˆæœ¬æµ‹è¯•
bun run test:precedence-separated    # ä¼˜å…ˆçº§çˆ¬å‡åˆ†ç¦»ç‰ˆæœ¬æµ‹è¯•
```

### æµ‹è¯•ç»“æœç¤ºä¾‹
```
ğŸ“Š æµ‹è¯•æ€»ç»“:
   æ€»æµ‹è¯•æ•°: 75
   é€šè¿‡: 73 âœ…
   å¤±è´¥: 2 âŒ
   æˆåŠŸç‡: 97.3%
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
- **åŸºæœ¬è¡¨è¾¾å¼**: 100% é€šè¿‡ - æ‰€æœ‰æ•´æ•°è¿ç®—éƒ½æ­£ç¡®
- **è¿ç®—ç¬¦ä¼˜å…ˆçº§**: 100% é€šè¿‡ - ä¼˜å…ˆçº§å’Œç»“åˆæ€§éƒ½æ­£ç¡®  
- **æ€§èƒ½æµ‹è¯•**: 93.8% é€šè¿‡ - æ·±åº¦åµŒå¥—å’Œé•¿è¡¨è¾¾å¼å¤„ç†è‰¯å¥½
- **è¾¹ç•Œæƒ…å†µ**: 95.5% é€šè¿‡ - åŒ…å«é¢„æœŸçš„è®¾è®¡é™åˆ¶ï¼ˆé™¤é›¶ç­‰ï¼‰

### é¢„æœŸå¤±è´¥è¯´æ˜
- **é™¤é›¶é”™è¯¯**: æ­£ç¡®é”™è¯¯å¤„ç†ï¼Œè§£æå™¨æ­£ç¡®æ£€æµ‹å¼‚å¸¸
- **è¶…å¤§æ•°è¿ç®—**: æ•°å€¼æº¢å‡ºï¼Œç¬¦åˆJavaScriptæ•°å€¼èŒƒå›´é™åˆ¶

## ğŸ§  æ ¸å¿ƒç®—æ³•

### 1. é€’å½’ä¸‹é™è§£æ
```typescript
function evalAddSubExpr(): number {
    let result = evalMulDivExpr();
    while (token === TokenType.ADD || token === TokenType.SUB) {
        const op = token;
        getToken();
        const right = evalMulDivExpr();
        result = op === TokenType.ADD ? result + right : result - right;
    }
    return result;
}
```

### 2. ä¼˜å…ˆçº§çˆ¬å‡è§£æï¼ˆwhileå¾ªç¯æ–¹å¼ï¼‰
```typescript
function parseExpression(minPrecedence: Precedence = Precedence.NONE): ASTNode {
    let left = parsePrimary();
    
    while (true) {
        const currentToken = token;
        const precedence = getPrecedence(currentToken);
        
        if (precedence < minPrecedence || precedence === Precedence.NONE) {
            break;
        }
        
        getToken(); // æ¶ˆè´¹æ“ä½œç¬¦
        
        const rightMinPrecedence = precedence + (isRightAssociative(currentToken) ? 0 : 1);
        const right = parseExpression(rightMinPrecedence);
        
        left = createBinaryNode(currentToken, left, right);
    }
    
    return left;
}
```

### 3. è¿ç®—ç¬¦ç»“åˆæ€§å¤„ç†
- **å·¦ç»“åˆ**ï¼š`rightMinPrecedence = precedence + 1`ï¼Œç¡®ä¿å³æ“ä½œæ•°ç”¨æ›´é«˜ä¼˜å…ˆçº§è§£æ
- **å³ç»“åˆ**ï¼š`rightMinPrecedence = precedence + 0`ï¼Œå…è®¸å³æ“ä½œæ•°ç”¨ç›¸åŒä¼˜å…ˆçº§è§£æ

```typescript
function isRightAssociative(token: TokenType): boolean {
    return token === TokenType.POWER;  // åªæœ‰ ** æ˜¯å³ç»“åˆ
}
```

### 4. ç®—æ³•å¯¹æ¯”
| ç‰¹æ€§ | é€’å½’ä¸‹é™ | ä¼˜å…ˆçº§çˆ¬å‡ |
|------|----------|------------|
| **æ§åˆ¶ç»“æ„** | å¤šä¸ªé€’å½’å‡½æ•° | å•ä¸€whileå¾ªç¯ |
| **ä¼˜å…ˆçº§å¤„ç†** | å‡½æ•°è°ƒç”¨å±‚æ¬¡ | ä¼˜å…ˆçº§è¡¨+å‚æ•° |
| **ä»£ç å¤æ‚åº¦** | ç®€å•ç›´è§‚ | æ›´ç´§å‡‘é«˜æ•ˆ |
| **é€’å½’æ·±åº¦** | æœ‰é™åˆ¶ | æ— é™åˆ¶ |
| **æ‰©å±•æ€§** | éœ€ä¿®æ”¹å¤šä¸ªå‡½æ•° | åªéœ€ä¿®æ”¹ä¼˜å…ˆçº§è¡¨ |

### 5. ä¼˜å…ˆçº§çˆ¬å‡ä¸é€†æ³¢å…°è¡¨è¾¾å¼çš„ç›¸ä¼¼æ€§

ä¼˜å…ˆçº§çˆ¬å‡è§£æå™¨ä¸é€†æ³¢å…°è¡¨è¾¾å¼ï¼ˆRPNï¼‰å¤„ç†åœ¨ç®—æ³•æ€æƒ³ä¸Šé«˜åº¦ç›¸ä¼¼ï¼š

#### **æ ¸å¿ƒæ€æƒ³ç›¸ä¼¼**
- **ä¼˜å…ˆçº§æ¯”è¾ƒæœºåˆ¶**: éƒ½é€šè¿‡ä¼˜å…ˆçº§è¡¨å†³å®šä½•æ—¶å¤„ç†æ“ä½œç¬¦
- **å»¶è¿Ÿå¤„ç†ç­–ç•¥**: é‡åˆ°æ›´é«˜ä¼˜å…ˆçº§æ—¶æ‰å¤„ç†å½“å‰æ“ä½œç¬¦
- **ç»“åˆæ€§å¤„ç†**: éƒ½æ­£ç¡®å¤„ç†å·¦ç»“åˆå’Œå³ç»“åˆæ“ä½œç¬¦

#### **ç®—æ³•æµç¨‹å¯¹æ¯”**

**ä¼˜å…ˆçº§çˆ¬å‡è§£æå™¨**:
```typescript
function parseExpression(minPrecedence: Precedence): ASTNode {
    let left = parsePrimary();
    while (true) {
        const precedence = getPrecedence(currentToken);
        if (precedence < minPrecedence) break;
        // å¤„ç†æ“ä½œç¬¦...
    }
}
```

**é€†æ³¢å…°è¡¨è¾¾å¼å¤„ç†**:
```typescript
// ä¼ªä»£ç ï¼šå¤„ç†æ“ä½œç¬¦æ ˆ
while (operatorStack.length > 0 && 
       precedence(operatorStack.top()) >= precedence(currentToken)) {
    const op = operatorStack.pop();
    // å¤„ç†æ“ä½œç¬¦...
}
```

#### **ç›¸ä¼¼æ€§åˆ†æè¡¨**
| ç‰¹æ€§ | ä¼˜å…ˆçº§çˆ¬å‡ | é€†æ³¢å…°å¤„ç† |
|------|------------|------------|
| **æ“ä½œç¬¦ä¼˜å…ˆçº§** | é€šè¿‡ `getPrecedence()` æ¯”è¾ƒ | é€šè¿‡ä¼˜å…ˆçº§è¡¨æ¯”è¾ƒ |
| **ç»“åˆæ€§å¤„ç†** | `rightMinPrecedence` å‚æ•° | æ ˆé¡¶æ“ä½œç¬¦ä¼˜å…ˆçº§æ¯”è¾ƒ |
| **å»¶è¿Ÿå¤„ç†** | é‡åˆ°æ›´é«˜ä¼˜å…ˆçº§æ‰å¤„ç† | é‡åˆ°æ›´é«˜ä¼˜å…ˆçº§æ‰å¤„ç† |
| **æ ˆå¼æ€ç»´** | é€’å½’è°ƒç”¨æ ˆæ¨¡æ‹Ÿ | æ˜¾å¼æ“ä½œç¬¦æ ˆ |

#### **ä¸»è¦åŒºåˆ«**
| æ–¹é¢ | ä¼˜å…ˆçº§çˆ¬å‡ | é€†æ³¢å…° |
|------|------------|--------|
| **å®ç°æ–¹å¼** | é€’å½’å‡½æ•° | æ˜¾å¼æ ˆ |
| **å†…å­˜ä½¿ç”¨** | è°ƒç”¨æ ˆ | æ“ä½œç¬¦æ ˆ+æ“ä½œæ•°æ ˆ |
| **ä»£ç ç»“æ„** | å•ä¸€å‡½æ•° | å¤šä¸ªå‡½æ•° |
| **æ‰©å±•æ€§** | æ˜“äºæ·»åŠ æ–°æ“ä½œç¬¦ | éœ€è¦ä¿®æ”¹æ ˆå¤„ç†é€»è¾‘ |

**ç»“è®º**: ä¼˜å…ˆçº§çˆ¬å‡è§£æå™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**é€’å½’ç‰ˆæœ¬çš„é€†æ³¢å…°è¡¨è¾¾å¼å¤„ç†ç®—æ³•**ï¼Œä¸¤è€…éƒ½éµå¾ª"ä¼˜å…ˆçº§é©±åŠ¨"çš„æ ¸å¿ƒç®—æ³•æ€æƒ³ã€‚

### 6. ASTæ ‘ç»“æ„åˆ†æç¤ºä¾‹

#### **å¤æ‚è¡¨è¾¾å¼**: `1+2*3**2**2`

##### **ASTæ ‘ç»“æ„å›¾**
```
                    BinaryOp(+)
                   /           \
            Number(1)          BinaryOp(*)
                               /           \
                        Number(2)          BinaryOp(**)
                                           /           \
                                    Number(3)          BinaryOp(**)
                                                       /           \
                                                Number(2)          Number(2)
```

##### **è¯¦ç»†èŠ‚ç‚¹åˆ†æ**
1. **æ ¹èŠ‚ç‚¹ - åŠ æ³•è¿ç®—**: `1 + (2*3**2**2)`
2. **å³å­æ ‘ - ä¹˜æ³•è¿ç®—**: `2 * (3**2**2)`
3. **å³å­æ ‘çš„å³å­æ ‘ - ç¬¬ä¸€ä¸ªæŒ‡æ•°è¿ç®—**: `3 ** (2**2)`
4. **å³å­æ ‘çš„å³å­æ ‘çš„å³å­æ ‘ - ç¬¬äºŒä¸ªæŒ‡æ•°è¿ç®—**: `2 ** 2`

##### **è®¡ç®—è¿‡ç¨‹**
```
1. è®¡ç®— 2**2 = 4
2. è®¡ç®— 3**4 = 81  
3. è®¡ç®— 2*81 = 162
4. è®¡ç®— 1+162 = 163
```

##### **ä¼˜å…ˆçº§å’Œç»“åˆæ€§ä½“ç°**
- **ä¼˜å…ˆçº§**: `**` > `*` > `+`
- **å³ç»“åˆæ€§**: `3**2**2` è§£æä¸º `3**(2**2)`ï¼Œä¸æ˜¯ `(3**2)**2`
- **æ ‘ç»“æ„**: ç”±äºå³ç»“åˆæ€§ï¼ŒæŒ‡æ•°è¿ç®—å½¢æˆäº†å³å€¾æ–œçš„æ ‘ç»“æ„

##### **å®Œæ•´JSONç»“æ„**
```json
{
  "type": "BinaryOp",
  "operator": "+",
  "left": {"type": "Number", "value": 1},
  "right": {
    "type": "BinaryOp",
    "operator": "*",
    "left": {"type": "Number", "value": 2},
    "right": {
      "type": "BinaryOp",
      "operator": "**",
      "left": {"type": "Number", "value": 3},
      "right": {
        "type": "BinaryOp",
        "operator": "**",
        "left": {"type": "Number", "value": 2},
        "right": {"type": "Number", "value": 2}
      }
    }
  }
}
```

### AST èŠ‚ç‚¹ç±»å‹
```typescript
interface NumberNode {
    type: 'Number';
    value: number;
}

interface BinaryOpNode {
    type: 'BinaryOp';
    operator: string;
    left: ASTNode;
    right: ASTNode;
}
```

## ğŸ” è°ƒè¯•åŠŸèƒ½

### å¯ç”¨è°ƒè¯•æ¨¡å¼
```typescript
const DEBUG = true;  // åœ¨ index.ts ä¸­è®¾ç½®
```

### è°ƒè¯•è¾“å‡ºç¤ºä¾‹
```
[Debug] TOKEN:NUMBER
[Debug] EVAL:Expr
[Debug] EVAL:AddSubExpr
[Debug] EVAL:MulDivExpr
[Debug] EVAL:PrimaryExpr
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **[è¡¨è¾¾å¼æ‰§è¡Œæµç¨‹åˆ†æ](docs/expression-analysis.md)**ï¼šè¯¦ç»†åˆ†æ `1 + 2 * (3 + 1) - 5` çš„æ‰§è¡Œè¿‡ç¨‹
- **[è¿ç®—ç¬¦ç»“åˆæ€§åˆ†æ](docs/operator-associativity.md)**ï¼šå·¦ç»“åˆ vs å³ç»“åˆçš„å®ç°åŸç†
- **[ä¼˜å…ˆçº§çˆ¬å‡ç®—æ³•åˆ†æ](docs/precedence-climbing-analysis.md)**ï¼šè¯¦ç»†åˆ†æ `1+2*3**2**2+100` çš„æ‰§è¡Œè¿‡ç¨‹

## ğŸ—ï¸ é¡¹ç›®æ¶æ„è®¾è®¡

### æ–‡ä»¶å¤¹ç»„ç»‡åŸåˆ™
é¡¹ç›®é‡‡ç”¨**æŒ‰è§£ææ–¹æ³•åˆ†ç±»**çš„ç»„ç»‡æ–¹å¼ï¼š

```
bnf/                    # BNFæ–¹æ³•ï¼ˆé€’å½’ä¸‹é™ï¼‰
â”œâ”€â”€ index.ts           # é›†æˆç‰ˆæœ¬ï¼šè§£æ+æ±‚å€¼
â””â”€â”€ separated.ts       # åˆ†ç¦»ç‰ˆæœ¬ï¼šè§£æ+AST+ä»£ç ç”Ÿæˆ

precedence-climbing/    # ä¼˜å…ˆçº§çˆ¬å‡æ–¹æ³•
â”œâ”€â”€ index.ts           # é›†æˆç‰ˆæœ¬ï¼šè§£æ+æ±‚å€¼  
â””â”€â”€ separated.ts       # åˆ†ç¦»ç‰ˆæœ¬ï¼šè§£æ+AST+ä»£ç ç”Ÿæˆ
```

### è®¾è®¡ä¼˜åŠ¿
1. **æ¸…æ™°çš„æ–¹æ³•å¯¹æ¯”**ï¼šæ¯ç§è§£ææ–¹æ³•éƒ½æœ‰ç‹¬ç«‹çš„æ–‡ä»¶å¤¹
2. **ç»Ÿä¸€çš„å‘½åè§„èŒƒ**ï¼šæ¯ä¸ªæ–‡ä»¶å¤¹éƒ½åŒ…å« `index.ts`ï¼ˆé›†æˆï¼‰å’Œ `separated.ts`ï¼ˆåˆ†ç¦»ï¼‰
3. **ä¾¿äºå­¦ä¹ ç†è§£**ï¼šå¯ä»¥è½»æ¾å¯¹æ¯”ä¸åŒè§£æç®—æ³•çš„å®ç°
4. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªç‰ˆæœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤

### ç‰ˆæœ¬é€‰æ‹©æŒ‡å—
- **å­¦ä¹ é€’å½’ä¸‹é™**ï¼šä½¿ç”¨ `bnf/` æ–‡ä»¶å¤¹
- **å­¦ä¹ ä¼˜å…ˆçº§çˆ¬å‡**ï¼šä½¿ç”¨ `precedence-climbing/` æ–‡ä»¶å¤¹
- **éœ€è¦ä»£ç ç”Ÿæˆ**ï¼šä½¿ç”¨ `separated.ts` ç‰ˆæœ¬
- **ç®€å•æ±‚å€¼**ï¼šä½¿ç”¨ `index.ts` ç‰ˆæœ¬

## ğŸ¯ å­¦ä¹ ä»·å€¼

è¿™ä¸ªé¡¹ç›®æ˜¯å­¦ä¹ ç¼–è¯‘åŸç†çš„ç»ä½³ä¾‹å­ï¼Œæ¶µç›–äº†ï¼š

1. **è¯æ³•åˆ†æ**ï¼šToken è¯†åˆ«å’Œåˆ†ç±»
2. **è¯­æ³•åˆ†æ**ï¼šé€’å½’ä¸‹é™è§£æå™¨ vs ä¼˜å…ˆçº§çˆ¬å‡è§£æå™¨
3. **AST æ„å»º**ï¼šæŠ½è±¡è¯­æ³•æ ‘è®¾è®¡
4. **ä»£ç ç”Ÿæˆ**ï¼šæ±‡ç¼–ä»£ç ç”Ÿæˆ
5. **è¿ç®—ç¬¦ä¼˜å…ˆçº§**ï¼šè¯­æ³•è§„åˆ™è®¾è®¡
6. **ç»“åˆæ€§å¤„ç†**ï¼šå·¦ç»“åˆ vs å³ç»“åˆ
7. **ç®—æ³•å¯¹æ¯”**ï¼šä¸åŒè§£æç®—æ³•çš„å®ç°å’Œæ•ˆæœå¯¹æ¯”
8. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šè§£æã€æ±‚å€¼ã€ä»£ç ç”Ÿæˆçš„æ¨¡å—åŒ–è®¾è®¡
9. **æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼šå®Œæ•´çš„æµ‹è¯•æ¡†æ¶å’Œè‡ªåŠ¨åŒ–éªŒè¯
10. **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µçš„å¤„ç†å’ŒéªŒè¯

## ğŸš€ æ‰©å±•æ–¹å‘

- æ·»åŠ æ›´å¤šè¿ç®—ç¬¦ï¼ˆä½è¿ç®—ã€é€»è¾‘è¿ç®—ï¼‰
- æ”¯æŒå˜é‡å’Œèµ‹å€¼
- æ·»åŠ å‡½æ•°è°ƒç”¨
- ä¼˜åŒ–æ±‡ç¼–ä»£ç ç”Ÿæˆ
- æ”¯æŒæ›´å¤šæ•°æ®ç±»å‹ï¼ˆæµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ï¼‰

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**Happy Coding! ğŸ‰**
