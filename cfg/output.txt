ğŸ“– è¯»å–æ–‡ä»¶: tests/grade-check.txt
ğŸ“ æºä»£ç :
int checkGrade() {
    let grade = 0;
    let score = 70;
    {
      let i = 0;
      score = score + 1;
    }
    
    if (score >= 90) {
        grade = 1;  // Açº§
        let bonusA = 10;
        {
          grade = 10;
        }
        grade = 111;
    } else if (score >= 80) {
      let bonusB = 5;
      grade = 2;
      let grade = 2;  // Bçº§
      {
        grade = grade + 20;
        let c = 100;
      }
      let cc = 1110;
      cc = 222;
    } else if (score >= 60) {
      grade = 3; // C çº§
    }
    let k = 9990;

    if (k) {
      let jj = 111;
      {
        let j = 1111;
        if (j > 0) {
          j = 222;
        }
        let j11= 1231;
        {
          let xx = 1;
        }
      }
      let j111 = 123123;
    }
    return grade;
}

ğŸ” è§£ææºä»£ç ...
âš™ï¸ ç¼–è¯‘ä¸ºæ±‡ç¼–...
ğŸ“Š ç”Ÿæˆæ§åˆ¶æµå›¾...

ğŸ“‹ æ§åˆ¶æµå›¾ (CFG):
åŸºæœ¬å—: checkGrade_entry_block
  [å…¥å£å—]
  è¯­å¥:
    - å£°æ˜letå˜é‡ grade
    - å£°æ˜letå˜é‡ score
  å‰é©±å—: æ— 
  åç»§å—: checkGrade_block_2

åŸºæœ¬å—: checkGrade_block_2
  è¯­å¥:
    - ä»£ç å— 
      {
          - å£°æ˜letå˜é‡ i
          - èµ‹å€¼ score = å˜é‡: score + æ•°å­—: 1
      }
  å‰é©±å—: checkGrade_entry_block
  åç»§å—: checkGrade_block_3

åŸºæœ¬å—: checkGrade_block_3
  è¯­å¥:
    - å˜é‡: score >= æ•°å­—: 90
  å‰é©±å—: checkGrade_block_2
  åç»§å—: checkGrade_block_4, checkGrade_block_7

åŸºæœ¬å—: checkGrade_block_4
  è¯­å¥:
    - èµ‹å€¼ grade = æ•°å­—: 1
    - å£°æ˜letå˜é‡ bonusA
  å‰é©±å—: checkGrade_block_3
  åç»§å—: checkGrade_block_5

åŸºæœ¬å—: checkGrade_block_5
  è¯­å¥:
    - ä»£ç å— 
      {
          - èµ‹å€¼ grade = æ•°å­—: 10
      }
    - èµ‹å€¼ grade = æ•°å­—: 111
  å‰é©±å—: checkGrade_block_4
  åç»§å—: checkGrade_block_16

åŸºæœ¬å—: checkGrade_block_7
  è¯­å¥:
    - å˜é‡: score >= æ•°å­—: 80
  å‰é©±å—: checkGrade_block_3
  åç»§å—: checkGrade_block_8, checkGrade_block_11

åŸºæœ¬å—: checkGrade_block_8
  è¯­å¥:
    - å£°æ˜letå˜é‡ bonusB
    - èµ‹å€¼ grade = æ•°å­—: 2
    - å£°æ˜letå˜é‡ grade
  å‰é©±å—: checkGrade_block_7
  åç»§å—: checkGrade_block_9

åŸºæœ¬å—: checkGrade_block_16
  è¯­å¥:
    - å£°æ˜letå˜é‡ k
  å‰é©±å—: checkGrade_block_5, checkGrade_block_9, checkGrade_block_12, checkGrade_block_11
  åç»§å—: checkGrade_block_17

åŸºæœ¬å—: checkGrade_block_9
  è¯­å¥:
    - ä»£ç å— 
      {
          - èµ‹å€¼ grade = å˜é‡: grade + æ•°å­—: 20
          - å£°æ˜letå˜é‡ c
      }
    - å£°æ˜letå˜é‡ cc
    - èµ‹å€¼ cc = æ•°å­—: 222
  å‰é©±å—: checkGrade_block_8
  åç»§å—: checkGrade_block_16

åŸºæœ¬å—: checkGrade_block_11
  è¯­å¥:
    - å˜é‡: score >= æ•°å­—: 60
  å‰é©±å—: checkGrade_block_7
  åç»§å—: checkGrade_block_12, checkGrade_block_16

åŸºæœ¬å—: checkGrade_block_17
  è¯­å¥:
    - å˜é‡: k
  å‰é©±å—: checkGrade_block_16
  åç»§å—: checkGrade_block_18, checkGrade_block_26

åŸºæœ¬å—: checkGrade_block_12
  è¯­å¥:
    - èµ‹å€¼ grade = æ•°å­—: 3
  å‰é©±å—: checkGrade_block_11
  åç»§å—: checkGrade_block_16

åŸºæœ¬å—: checkGrade_block_18
  è¯­å¥:
    - å£°æ˜letå˜é‡ jj
    - å£°æ˜letå˜é‡ j
  å‰é©±å—: checkGrade_block_17
  åç»§å—: checkGrade_block_19

åŸºæœ¬å—: checkGrade_block_19
  è¯­å¥:
    - å˜é‡: j > æ•°å­—: 0
  å‰é©±å—: checkGrade_block_18
  åç»§å—: checkGrade_block_20, checkGrade_block_22

åŸºæœ¬å—: checkGrade_block_20
  è¯­å¥:
    - èµ‹å€¼ j = æ•°å­—: 222
  å‰é©±å—: checkGrade_block_19
  åç»§å—: checkGrade_block_22

åŸºæœ¬å—: checkGrade_block_26
  è¯­å¥:
    - è¿”å›è¯­å¥
  å‰é©±å—: checkGrade_block_23, checkGrade_block_17
  åç»§å—: checkGrade_block_1

åŸºæœ¬å—: checkGrade_block_22
  è¯­å¥:
    - å£°æ˜letå˜é‡ j11
  å‰é©±å—: checkGrade_block_20, checkGrade_block_19
  åç»§å—: checkGrade_block_23

åŸºæœ¬å—: checkGrade_block_1
  [å‡ºå£å—]
  è¯­å¥:
    - (ç©º)
  å‰é©±å—: checkGrade_block_26
  åç»§å—: æ— 

åŸºæœ¬å—: checkGrade_block_23
  è¯­å¥:
    - ä»£ç å— 
      {
          - å£°æ˜letå˜é‡ xx
      }
    - å£°æ˜letå˜é‡ j111
  å‰é©±å—: checkGrade_block_22
  åç»§å—: checkGrade_block_26

æ§åˆ¶æµè¾¹:
  checkGrade_entry_block â†’ checkGrade_block_2
  checkGrade_block_2 â†’ checkGrade_block_3
  checkGrade_block_3 â†’ checkGrade_block_4
  checkGrade_block_3 â†’ checkGrade_block_7
  checkGrade_block_4 â†’ checkGrade_block_5
  checkGrade_block_5 â†’ checkGrade_block_16
  checkGrade_block_7 â†’ checkGrade_block_8
  checkGrade_block_7 â†’ checkGrade_block_11
  checkGrade_block_8 â†’ checkGrade_block_9
  checkGrade_block_16 â†’ checkGrade_block_17
  checkGrade_block_9 â†’ checkGrade_block_16
  checkGrade_block_11 â†’ checkGrade_block_12
  checkGrade_block_11 â†’ checkGrade_block_16
  checkGrade_block_17 â†’ checkGrade_block_18
  checkGrade_block_17 â†’ checkGrade_block_26
  checkGrade_block_12 â†’ checkGrade_block_16
  checkGrade_block_18 â†’ checkGrade_block_19
  checkGrade_block_19 â†’ checkGrade_block_20
  checkGrade_block_19 â†’ checkGrade_block_22
  checkGrade_block_20 â†’ checkGrade_block_22
  checkGrade_block_26 â†’ checkGrade_block_1
  checkGrade_block_22 â†’ checkGrade_block_23
  checkGrade_block_23 â†’ checkGrade_block_26

âš™ï¸ ç”Ÿæˆæ±‡ç¼–ä»£ç ...
ğŸš€ è¿è¡Œæ±‡ç¼–ä»£ç ...

è¿è¡Œå‡½æ•°: checkGrade
æ±‡ç¼–ä»£ç :
; Function: checkGrade
checkGrade:

checkGrade_entry_block:
  sub esp, 2            ; ä¸º2ä¸ªå‡½æ•°çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 0
  si -1              ; åˆå§‹åŒ– grade
  mov eax, 70
  si -2              ; åˆå§‹åŒ– score
  jmp checkGrade_block_2

checkGrade_block_2:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 0
  si -3              ; åˆå§‹åŒ– i
  li -2
  push eax
  mov eax, 1
  mov ebx, eax
  pop eax
  add eax, ebx
  si -2              ; èµ‹å€¼ç»™ score
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_3

checkGrade_block_3:
  li -2
  push eax
  mov eax, 90
  mov ebx, eax
  pop eax
  cmp eax, ebx
  jge checkGrade_block_4     ; å¦‚æœ >= åˆ™è·³è½¬åˆ°trueåˆ†æ”¯
  jmp checkGrade_block_7    ; å¦åˆ™è·³è½¬åˆ°falseåˆ†æ”¯

checkGrade_block_4:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 1
  si -1              ; èµ‹å€¼ç»™ grade
  mov eax, 10
  si -3              ; åˆå§‹åŒ– bonusA
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_5

checkGrade_block_5:
  mov eax, 10
  si -1              ; èµ‹å€¼ç»™ grade
  mov eax, 111
  si -1              ; èµ‹å€¼ç»™ grade
  jmp checkGrade_block_16

checkGrade_block_7:
  li -2
  push eax
  mov eax, 80
  mov ebx, eax
  pop eax
  cmp eax, ebx
  jge checkGrade_block_8     ; å¦‚æœ >= åˆ™è·³è½¬åˆ°trueåˆ†æ”¯
  jmp checkGrade_block_11    ; å¦åˆ™è·³è½¬åˆ°falseåˆ†æ”¯

checkGrade_block_8:
  sub esp, 2            ; ä¸º2ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 5
  si -3              ; åˆå§‹åŒ– bonusB
  mov eax, 2
  si -1              ; èµ‹å€¼ç»™ grade
  mov eax, 2
  si -4              ; åˆå§‹åŒ– grade
  add esp, 2            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_9

checkGrade_block_16:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 9990
  si -3              ; åˆå§‹åŒ– k
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_17

checkGrade_block_9:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  li -1
  push eax
  mov eax, 20
  mov ebx, eax
  pop eax
  add eax, ebx
  si -1              ; èµ‹å€¼ç»™ grade
  mov eax, 100
  si -4              ; åˆå§‹åŒ– c
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  mov eax, 1110
  si -3              ; åˆå§‹åŒ– cc
  mov eax, 222
  si -3              ; èµ‹å€¼ç»™ cc
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_16

checkGrade_block_11:
  li -2
  push eax
  mov eax, 60
  mov ebx, eax
  pop eax
  cmp eax, ebx
  jge checkGrade_block_12     ; å¦‚æœ >= åˆ™è·³è½¬åˆ°trueåˆ†æ”¯
  jmp checkGrade_block_16    ; å¦åˆ™è·³è½¬åˆ°falseåˆ†æ”¯

checkGrade_block_17:
  mov eax, 0
  jmp checkGrade_block_18

checkGrade_block_12:
  mov eax, 3
  si -1              ; èµ‹å€¼ç»™ grade
  jmp checkGrade_block_16

checkGrade_block_18:
  sub esp, 2            ; ä¸º2ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 111
  si -3              ; åˆå§‹åŒ– jj
  mov eax, 1111
  si -4              ; åˆå§‹åŒ– j
  add esp, 2            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_19

checkGrade_block_19:
  mov eax, 0
  push eax
  mov eax, 0
  mov ebx, eax
  pop eax
  cmp eax, ebx
  jg checkGrade_block_20     ; å¦‚æœ > åˆ™è·³è½¬åˆ°trueåˆ†æ”¯
  jmp checkGrade_block_22    ; å¦åˆ™è·³è½¬åˆ°falseåˆ†æ”¯

checkGrade_block_20:
  mov eax, 222
  ; æœªæ‰¾åˆ°å˜é‡ j
  jmp checkGrade_block_22

checkGrade_block_26:
  li -1              ; è¿”å›å‡½æ•°çº§å˜é‡ grade
  add esp, 2            ; é‡Šæ”¾æ‰€æœ‰å˜é‡æ ˆç©ºé—´
  mov ebx, 0              ; æ¸…ç† ebx
  ret

checkGrade_block_22:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 1231
  si -3              ; åˆå§‹åŒ– j11
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_23

checkGrade_block_1:
  add esp, 2            ; é‡Šæ”¾æ‰€æœ‰å˜é‡æ ˆç©ºé—´
  mov eax, 0              ; é»˜è®¤è¿”å›å€¼
  mov ebx, 0              ; æ¸…ç† ebx
  ret              ; å‡½æ•°ç»“æŸè¿”å›

checkGrade_block_23:
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  sub esp, 1            ; ä¸º1ä¸ªå—çº§å˜é‡åˆ†é…æ ˆç©ºé—´
  mov eax, 1
  si -4              ; åˆå§‹åŒ– xx
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  mov eax, 123123
  si -3              ; åˆå§‹åŒ– j111
  add esp, 1            ; é‡Šæ”¾å—çº§å˜é‡æ ˆç©ºé—´
  jmp checkGrade_block_26

DEBUG: si -1 - storing ax(0) to bp(1023) + -1 = 1022
DEBUG: si -2 - storing ax(70) to bp(1023) + -2 = 1021
DEBUG: si -3 - storing ax(0) to bp(1023) + -3 = 1020
DEBUG: li -2 - loading from bp(1023) + -2 = 1021, value = 70
DEBUG: si -2 - storing ax(71) to bp(1023) + -2 = 1021
DEBUG: li -2 - loading from bp(1023) + -2 = 1021, value = 71
DEBUG: li -2 - loading from bp(1023) + -2 = 1021, value = 71
DEBUG: li -2 - loading from bp(1023) + -2 = 1021, value = 71
DEBUG: si -1 - storing ax(3) to bp(1023) + -1 = 1022
DEBUG: si -3 - storing ax(9990) to bp(1023) + -3 = 1020
DEBUG: si -3 - storing ax(111) to bp(1023) + -3 = 1020
DEBUG: si -4 - storing ax(1111) to bp(1023) + -4 = 1019
DEBUG: si -3 - storing ax(1231) to bp(1023) + -3 = 1020
DEBUG: si -4 - storing ax(1) to bp(1023) + -4 = 1019
DEBUG: si -3 - storing ax(123123) to bp(1023) + -3 = 1020
DEBUG: li -1 - loading from bp(1023) + -1 = 1022, value = 3

VM è¿è¡Œç»“æœ:
æˆåŠŸ: true
è¾“å‡º: 
æ‰§è¡Œå‘¨æœŸ: 84
AX å¯„å­˜å™¨å€¼: 3
BX å¯„å­˜å™¨å€¼: 0
SP å¯„å­˜å™¨å€¼: 1023
BP å¯„å­˜å™¨å€¼: 1023

âœ… è¿è¡ŒæˆåŠŸ!
ğŸ“Š ç»“æœ: å‡½æ•° checkGrade: AX = 3

ğŸ“‹ è¯¦ç»†ç»“æœ:

å‡½æ•°: checkGrade
è¿”å›å€¼ (AX): 3
å¯„å­˜å™¨çŠ¶æ€:
  AX: 3
  BX: 0
  SP: 1023
  BP: 1023
